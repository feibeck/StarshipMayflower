# 2. Architecture Constraints

This section documents the constraints that limit architectural freedom in design and implementation decisions. These constraints are imposed requirements that must be satisfied—they are not negotiable design choices.

**Note:** Constraints are imposed limitations (technical mandates, legal requirements, existing infrastructure). Design decisions chosen by architects are documented in section 4 (Solution Strategy), not here.

| Constraint | Background / Motivation |
|------------|-------------------------|
| **Browser-based deployment** | System must run in standard web browsers without requiring native client installation[^1]. This is a fundamental business requirement stated in the project description: "A starship bridge simulator running in your browser." Constrains both frontend (must use browser-compatible JavaScript/TypeScript, WebGL for 3D graphics) and backend (must support WebSocket for real-time communication). **Why:** Enables players to join games without software installation, reduces deployment friction, supports cross-platform play. |
| **TypeScript 4.4+ with React 17 and Node.js** | Core technology stack. TypeScript ~4.4.3 as primary language[^2], React 17.0.2 for frontend UI[^3], Node.js runtime for both build tooling and game server[^4]. TypeScript compiler targets ES2015 for broad browser compatibility[^5]. **Why:** TypeScript enables type safety across 80+ source files in monorepo; React provides mature component ecosystem; Node.js enables isomorphic JavaScript between client and server. These were established early in the project and changing would require complete rewrite. |
| **Pinus multiplayer game server framework** | Game server tightly coupled to Pinus framework v1.4.14[^6]. Pinus is a Node.js game server framework (successor to Pomelo) that provides distributed server architecture (connector servers for client connections, world servers for game logic), binary WebSocket protocol with protobuf encoding, and dictionary-based message compression. **Why:** Real-time multiplayer gaming requires specialized framework with built-in features for connection management, RPC, and efficient protocols. Migration to alternative frameworks (Socket.io, Colyseus) would require extensive refactoring of server architecture and protocol handling. |
| **Nx monorepo workspace** | Project organized as Nx workspace v13.2.3 with enforced module boundaries[^7]. Establishes mandatory project structure (apps/ for applications, libs/ for shared libraries), build orchestration (nx serve, nx build, nx test commands), and library sharing via TypeScript path mappings[^8]. ESLint rules prevent unauthorized imports across library boundaries. **Why:** Nx enforces architectural discipline through tooling, enables incremental builds, and supports multiple applications sharing code. Migration away from Nx would require reorganizing entire repository structure and rebuilding dependency graph. |
| **WebSocket real-time communication protocol** | Architecture mandates WebSocket for client-server communication[^9]. The Pinus framework's binary protocol uses dictionary compression and protobuf encoding for network efficiency (target <1KB per world update with 40 concurrent players). **Why:** Turn-based or request-response patterns (REST, GraphQL) insufficient for real-time multiplayer with 10 Hz server tick rate (100ms update cycles). WebSocket provides full-duplex communication required for pushing ship position updates to all connected clients simultaneously. |
| **In-memory state without persistent database** | System operates with ephemeral in-memory state only—no external database infrastructure (no PostgreSQL, MongoDB, Redis, etc.)[^10]. Game state lost on server restart. **Why:** Current constraint appears architectural (simplifies deployment, reduces dependencies) rather than technical necessity. **Negotiable:** This constraint likely negotiable for future versions requiring persistent player accounts, game history, or scalability beyond single server. **See:** Section 4 (Solution Strategy) for rationale behind stateless architecture. |
| **MIT open-source license** | Project licensed under MIT License[^11], requiring all dependencies use compatible permissive licenses. Prohibits incorporating GPL-licensed libraries (would impose viral copyleft requirements) or proprietary code without appropriate permissions. **Why:** MIT license chosen to maximize project accessibility and allow commercial use/modification. This is a legal constraint affecting dependency selection. |
| **Code style conventions: ESLint + Prettier** | Enforced code formatting and linting via ESLint 7.32.0 with TypeScript plugin and Prettier 2.3.1[^12]. Configuration mandates: single quotes, Nx module boundary enforcement, TypeScript strict checks. **Why:** Automated code style enforcement eliminates style debates, ensures consistency across 80+ TypeScript files, and catches common errors. Enforced via editor integration and CI pipeline (though CI configuration currently outdated—.travis.yml targets legacy Node 0.10). |

> **Cross-references:**
> - Section 1.2 (Quality Goals) distinguishes quality attributes from constraints
> - Section 4 (Solution Strategy) explains how architecture addresses these constraints
> - Section 7 (Deployment View) provides deployment details for browser and Node.js constraints
> - Section 8 (Crosscutting Concepts) describes conventions for code organization

> **Note on organizational constraints:** No organizational process constraints (team structure, release schedules, approval workflows, compliance requirements) are documented in the repository. Development appears to be open-source community-driven without formal organizational mandates.

[^1]: README.md line 5 "A starship bridge simulator running in your browser"; package.json description field
[^2]: package.json line 86 specifies "typescript": "~4.4.3"; TypeScript used throughout apps/ and libs/
[^3]: package.json line 31 "react": "17.0.2"; all frontend components in apps/starship-mayflower-frontend/src/
[^4]: README.md line 9 "Install npm" prerequisite; package.json scripts use npm/nx; Pinus framework requires Node.js runtime
[^5]: tsconfig.base.json line 11 "target": "es2015", line 13 "lib": ["es2017", "dom"]; balances modern features with browser compatibility
[^6]: package.json line 30 "pinus": "^1.4.14"; apps/game-server/src/main.ts imports from 'pinus'; connector/world server topology in apps/game-server/src/config/servers.json
[^7]: .eslintrc.json lines 9-21 enforce "@nrwl/nx/enforce-module-boundaries" rule with error level; nx.json line 2 npmScope "starship-mayflower"
[^8]: tsconfig.base.json lines 17-24 define path mappings @starship-mayflower/compass, @starship-mayflower/map, @starship-mayflower/util, @starship-mayflower/game-server-lib
[^9]: apps/game-server/src/main.ts lines 12-17 configure connectorConfig with hybridconnector, heartbeat: 3, useDict: true, useProtobuf: true
[^10]: No Dockerfile, docker-compose.yml, or database configs in repository root; no database drivers (pg, mysql, mongodb, redis, sequelize, typeorm) in package.json dependencies; game-server/src/game.ts uses in-memory registries
[^11]: package.json line 10 "license": "MIT"
[^12]: package.json lines 70-71 "@typescript-eslint/eslint-plugin": "~4.33.0", line 75 "eslint": "7.32.0", line 83 "prettier": "^2.3.1"; .eslintrc.json configures rules; .prettierrc line 2 "singleQuote": true
