sequenceDiagram
    participant Client as Frontend SPA
    participant WS as WebSocket Connection
    participant Connector as Connector Server
    participant Entry as Entry Handler
    participant World as World Server
    participant PlayerRPC as Player Remote
    participant Registry as ShipRegistry
    participant Channel as Channel Service

    Note over Client,WS: Normal Operation
    Client->>WS: Sending navigation commands
    WS->>Connector: Binary protocol messages

    Note over Client,Entry: Connection Failure Scenario
    WS--xClient: Network failure /<br/>Browser tab closed /<br/>Client crash

    Note over Connector,Entry: Server-Side Detection
    Connector->>Entry: session.on('closed') event
    Entry->>Entry: Check session.uid exists
    alt Session authenticated
        Entry->>World: RPC: world.player.playerLeave<br/>{playerId: session.playerId}
        World->>PlayerRPC: playerLeave(playerId)
        PlayerRPC->>Registry: shipRegistry.removePlayer(playerId)
        Registry->>Registry: Find ship with player
        Registry->>Registry: Detach player from ship
        Registry->>Registry: Release station if assigned
        PlayerRPC->>Channel: pushToShip("PlayerLeft", {playerId})
        PlayerRPC->>Channel: pushToLobby("PlayerLeft", {playerId})
        Channel-->>Client: Broadcast to other players
        PlayerRPC-->>Entry: Player removed
    else Session not authenticated
        Entry->>Entry: No cleanup needed
    end

    Note over Client,WS: Client-Side Detection
    Client->>Client: WebSocket error event
    Client->>Client: GameMiddleware catches error
    Client->>Client: Dispatch connectionError() action
    Client->>Client: Redux: set connected = false
    Client->>Client: UI shows "Connection Lost" message

    Note over Client,WS: Reconnection Attempt
    Client->>Client: User clicks "Reconnect" button
    Client->>WS: new WebSocket(url)
    WS->>Connector: Connection established
    Client->>Entry: RPC: entry.entry({username})
    Entry-->>Client: New playerId assigned
    Note over Client: Player must rejoin ship<br/>and take station again