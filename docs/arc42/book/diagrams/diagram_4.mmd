sequenceDiagram
    participant Client as Frontend SPA
    participant Connector as Connector Server<br/>(port 3010)
    participant Entry as Entry Handler
    participant World as World Server<br/>(port 3151)
    participant Lobby as Lobby Handler
    participant Registry as ShipRegistry
    participant Channel as Channel Service

    Note over Client,Connector: WebSocket Connection Establishment
    Client->>Connector: Connect ws://localhost:3010
    Connector-->>Client: Connection established

    Note over Client,Entry: Authentication Phase
    Client->>Entry: RPC: entry.entry({username})
    Entry->>Entry: Generate playerId (serverId + counter)
    Entry->>Entry: Bind session to playerId
    Entry->>Entry: Register session.on('closed') handler
    Entry->>Channel: Push session to all channels
    Entry-->>Client: {code: OK, playerId: "1-1"}

    Note over Client,World: Game Joining Phase
    Client->>Lobby: RPC: lobby.joinShip({shipName})
    Lobby->>Registry: getShip(shipName)
    Registry-->>Lobby: Ship object
    Lobby->>Lobby: Create Player model
    Lobby->>Registry: addPlayer(player)
    Lobby->>Channel: pushToShip(shipName, "PlayerAdded")
    Lobby->>Channel: pushToLobby("PlayerAdded")
    Lobby-->>Client: {code: OK, payload: {ship}}
    Channel-->>Client: Broadcast: PlayerAdded event

    Note over Client,Lobby: Station Assignment
    Client->>Lobby: RPC: lobby.takeStation({station: "helm"})
    Lobby->>Registry: getPlayer(playerId)
    Lobby->>Lobby: ship.takeStation(player, station)
    alt Station available
        Lobby->>Lobby: Assign player to station
        Lobby->>Channel: pushToShip(shipName, "StationTaken")
        Lobby-->>Client: {code: OK}
        Channel-->>Client: Broadcast: StationTaken event
    else Station occupied
        Lobby-->>Client: {code: ERR, msg: "Position already taken"}
    end