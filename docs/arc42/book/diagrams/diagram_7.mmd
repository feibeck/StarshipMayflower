flowchart TD
    Start([Node.js: node main.js]) --> LoadPinus[Import pinus framework]
    LoadPinus --> LoadReflect[Import reflect-metadata<br/>TypeScript decorators]
    LoadReflect --> CreateApp[pinus.createApp<br/>base: __dirname]

    CreateApp --> LoadConfig[Load servers.json]
    LoadConfig --> ParseTopology{Parse server<br/>topology}
    ParseTopology --> ConnectorDef[connector-server-1<br/>port 3150, clientPort 3010]
    ParseTopology --> WorldDef[world-server-1<br/>port 3151]

    ConnectorDef --> SetName[app.set 'name'<br/>Starship Mayflower]
    WorldDef --> SetName

    SetName --> ConfigConnector[Configure connector server]
    ConfigConnector --> HybridConn[hybridconnector<br/>WebSocket native]
    HybridConn --> Heartbeat[heartbeat: 3s]
    Heartbeat --> UseDict[useDict: true<br/>message compression]
    UseDict --> UseProto[useProtobuf: true<br/>binary protocol]

    UseProto --> AppStart[app.start]

    AppStart --> LoadHandlers[Load handler modules]
    LoadHandlers --> EntryHandler[connector/handler/entry.ts]
    LoadHandlers --> LobbyHandler[world/handler/lobby.ts]
    LoadHandlers --> NavHandler[world/handler/navigation.ts]
    LoadHandlers --> GameHandler[world/handler/game.ts]

    EntryHandler --> LoadRemotes[Load RPC remote modules]
    LobbyHandler --> LoadRemotes
    NavHandler --> LoadRemotes
    GameHandler --> LoadRemotes
    LoadRemotes --> PlayerRemote[world/remote/player.ts]

    PlayerRemote --> InitChannels[Initialize channel service]
    InitChannels --> LobbyChannel[Create lobby channel]
    InitChannels --> GlobalChannel[Create global channel]

    LobbyChannel --> ListenPorts[Bind server ports]
    GlobalChannel --> ListenPorts
    ListenPorts --> Connector3150[Connector: 127.0.0.1:3150<br/>frontend connections]
    ListenPorts --> World3151[World: 127.0.0.1:3151<br/>backend RPC]

    Connector3150 --> GameInit[Game module initialization]
    World3151 --> GameInit
    GameInit --> CreateStations[Create space stations<br/>singletons]
    CreateStations --> CreatePlanets[Create planets<br/>singletons]
    CreatePlanets --> CreateRegistries[Instantiate:<br/>ObjectInSpaceRegistry<br/>ShipRegistry<br/>ActionManager]
    CreateRegistries --> Ready[Server ready<br/>Awaiting connections]

    Ready --> ClientConnect[Client connects<br/>ws://localhost:3010]
    ClientConnect --> GameStart{Game started?}
    GameStart -->|No| WaitStart[Wait for lobby.startGame]
    WaitStart --> StartCalled[User calls startGame]
    StartCalled --> InitTimer[timer.run<br/>actionManager]
    InitTimer --> TickLoop[10 Hz tick loop begins]
    GameStart -->|Yes| TickLoop

    style Start fill:#ff9999
    style Ready fill:#99ff99
    style TickLoop fill:#99ff99
    style ConfigConnector fill:#e1f5ff
    style LoadHandlers fill:#fff4e1
    style GameInit fill:#f0ffe1